# Music Recommendation System based on Autoencoder Embedding, KMeans Clustering, and Cosine Similarity

## å°ˆæ¡ˆç°¡ä»‹ (Purpose)

æ­¤å°ˆæ¡ˆæ—¨åœ¨å»ºç«‹ä¸€å€‹å…ˆé€²çš„éŸ³æ¨‚æ¨è–¦ç³»çµ±ï¼Œçµåˆäº†æ·±åº¦å­¸ç¿’ï¼ˆAutoencoderï¼‰ã€ç„¡ç›£ç£å­¸ç¿’ï¼ˆKMeans èšé¡ï¼‰èˆ‡ç›¸ä¼¼åº¦è¨ˆç®—ï¼ˆCosine Similarityï¼‰ï¼Œä»¥æä¾›ç”¨æˆ¶æ›´ç²¾æº–ä¸”èªæ„ç›¸é—œçš„æ­Œæ›²æ¨è–¦ã€‚ç³»çµ±èƒ½å¤ æ ¹æ“šä½¿ç”¨è€…æŒ‡å®šçš„æ­Œæ›²ï¼Œæ¨è–¦é¢¨æ ¼ç›¸ä¼¼çš„éŸ³æ¨‚ã€‚

ä¸»è¦ç‰¹é»:

1.  **èªæ„åŒ–æ­Œæ›²å®šä½**: ä»¥æ­Œæ›²åç¨±ï¼ˆèˆ‡å¯é¸çš„ artistï¼‰å®šä½ç›®æ¨™æ­Œæ›²ã€‚
2.  **Autoencoder Embedding**: ä½¿ç”¨ Autoencoder å°‡é«˜ç¶­åº¦çš„éŸ³æ¨‚ç‰¹å¾µå£“ç¸®æˆä½ç¶­åº¦çš„èªæ„ embeddingï¼Œä»¥æ•æ‰æ­Œæ›²çš„æ·±å±¤ç‰¹å¾µã€‚
3.  **KMeans èšé¡**: åœ¨ Autoencoder embedding ç©ºé–“ä¸­é€²è¡Œ KMeans èšé¡ï¼Œå°‡æ­Œæ›²åˆ†çµ„ï¼Œç¢ºä¿æ¨è–¦çµæœçš„é¢¨æ ¼ä¸€è‡´æ€§ã€‚
4.  **æ··åˆå¼æ¨è–¦ç­–ç•¥**: 
    *   **åŒç¾¤å„ªå…ˆ**: å„ªå…ˆå¾ç›®æ¨™æ­Œæ›²æ‰€å±¬çš„åŒä¸€ cluster ä¸­æŒ‘é¸æœ€ç›¸ä¼¼çš„æ­Œæ›²ï¼Œä»¥ä¿è­‰æ¨è–¦çµæœçš„é¢¨æ ¼æ¥è¿‘ã€‚
    *   **è·¨ç¾¤è£œè¶³**: è‹¥åŒ cluster æ­Œæ›²ä¸è¶³ä»¥æ»¿è¶³æ¨è–¦æ•¸é‡ï¼Œå°‡å•Ÿå‹•è·¨ cluster å‚™é¸æ©Ÿåˆ¶ï¼Œå¾å…¶ä»– cluster ä¸­æŒ‘é¸ç›¸ä¼¼åº¦æœ€é«˜çš„æ­Œæ›²è£œè¶³ï¼Œä¸¦é™åˆ¶æ¯å€‹ cluster çš„æœ€å¤§æ¨è–¦æ•¸é‡ (`max_per_cluster`)ï¼Œä»¥å…¼é¡§å¤šæ¨£æ€§èˆ‡æ§åˆ¶æ€§ã€‚
5.  **æ¸…æ™°çš„è¼¸å‡ºæ ¼å¼**: æœ€çµ‚æ¨è–¦åˆ—è¡¨åŒ…å« `track_name`, `artists`, `cluster` (æ­Œæ›²æ‰€å±¬èšé¡), `distance` (èˆ‡ç›®æ¨™æ­Œæ›²çš„ç›¸ä¼¼åº¦)ã€‚

## å¯¦é©—æ–¹æ³•èˆ‡æ­¥é©Ÿ (Experimental Methods)

### 1. è³‡æ–™è¼‰å…¥èˆ‡é è™•ç†
*   è¼‰å…¥ Spotify éŸ³æ¨‚æ•¸æ“šé›†ã€‚
*   å®šç¾©éŸ³è¨Šç‰¹å¾µ (`audio_features`) å’Œå…ƒæ•¸æ“šç‰¹å¾µ (`meta_features`)ã€‚
*   ç§»é™¤é‡è¤‡æ­Œæ›²ï¼Œç¢ºä¿æ¨è–¦çµæœçš„å”¯ä¸€æ€§ã€‚
*   ä½¿ç”¨ LabelEncoder å°‡åˆ†é¡ç‰¹å¾µ (å¦‚ `artists` å’Œ `track_genre`) è½‰æ›ç‚ºæ•¸å€¼å‹ï¼Œä»¥ä¾¿æ¨¡å‹è™•ç†ã€‚
*   å»ºç«‹åŒ…å«æ‰€æœ‰ç‰¹å¾µçš„é›†åˆ `all_features`ã€‚

### 2. ç‰¹å¾µç¸®æ”¾èˆ‡ä¸»æˆåˆ†åˆ†æ (PCA)
*   å°æ‰€æœ‰ç‰¹å¾µé€²è¡Œ `StandardScaler` ç¸®æ”¾è™•ç†ï¼Œä½¿æ•¸æ“šæ¨™æº–åŒ–ã€‚
*   ä½¿ç”¨ PCA é€²è¡Œæ•¸æ“šæ¢ç´¢å’Œè¦–è¦ºåŒ–ï¼Œåˆæ­¥äº†è§£æ•¸æ“šçµæ§‹ã€‚

### 3. Autoencoder æ¨¡å‹å»ºç«‹èˆ‡è¨“ç·´
*   å»ºç«‹ä¸€å€‹åŒ…å« Encoder å’Œ Decoder çš„å°ç¨±å¼ Autoencoder ç¥ç¶“ç¶²è·¯æ¨¡å‹ã€‚
*   Encoder å°‡é«˜ç¶­è¼¸å…¥å£“ç¸®æˆä½ç¶­çš„éš±è—è¡¨ç¤º (embedding)ã€‚
*   Decoder å˜—è©¦å¾éš±è—è¡¨ç¤ºé‡å»ºåŸå§‹è¼¸å…¥ã€‚
*   æ¨¡å‹ä½¿ç”¨ Adam å„ªåŒ–å™¨å’Œ MSE æå¤±å‡½æ•¸é€²è¡Œç·¨è­¯ã€‚
*   æ‡‰ç”¨ `EarlyStopping` å’Œ `ReduceLROnPlateau` å›èª¿å‡½æ•¸ä¾†å„ªåŒ–è¨“ç·´éç¨‹ï¼Œé˜²æ­¢éæ“¬åˆä¸¦å‹•æ…‹èª¿æ•´å­¸ç¿’ç‡ã€‚

### 4. KMeans èšé¡åˆ†æ
*   åˆ©ç”¨è¨“ç·´å¥½çš„ Encoder ç²å–æ¯é¦–æ­Œæ›²çš„ä½ç¶­ embeddingã€‚
*   åœ¨é€™äº› embedding ä¸Šæ‡‰ç”¨ KMeans æ¼”ç®—æ³•é€²è¡Œèšé¡ (k=8)ï¼Œå°‡æ­Œæ›²åˆ†æˆè‹¥å¹²å€‹ç¾¤çµ„ã€‚
*   å°‡èšé¡çµæœ (`cluster_ae_kmeans`) æ·»åŠ å› DataFrameã€‚

### 5. èšé¡çµæœè¦–è¦ºåŒ–èˆ‡é©—è­‰
*   å° Autoencoder embedding é€²è¡Œ PCA é™ç¶­è‡³ 2Dï¼Œä¸¦å°‡èšé¡çµæœç–ŠåŠ åˆ°æ•£ä½ˆåœ–ä¸Šï¼Œè¦–è¦ºåŒ–ç¾¤çµ„åˆ†ä½ˆã€‚
*   åœ¨åŸå§‹ç‰¹å¾µçš„ PCA 2D ç©ºé–“ä¸­ï¼Œå†æ¬¡è¦–è¦ºåŒ–èšé¡çµæœï¼Œä»¥è©•ä¼°ç¾¤çµ„åœ¨åŸå§‹æ•¸æ“šç©ºé–“ä¸­çš„åˆç†æ€§ã€‚
*   è©•ä¼° Silhouette Score, Calinski-Harabasz Score, Davies-Bouldin Index ç­‰æŒ‡æ¨™ï¼Œè¡¡é‡èšé¡å“è³ªã€‚

### 6. è‡ªå‹•ç”Ÿæˆèšé¡åç¨±
*   æ ¹æ“šæ¯å€‹ç¾¤çµ„åœ¨ç‰¹å®šèªç¾©ç‰¹å¾µï¼ˆå¦‚ energy, danceabilityï¼‰ä¸Šçš„ä¸­å¿ƒé»ï¼Œè‡ªå‹•ç”Ÿæˆå¯è®€ä¸”å”¯ä¸€çš„èšé¡åç¨±ã€‚
*   ç¢ºä¿åç¨±çš„å”¯ä¸€æ€§ï¼Œä¸¦å°‡å‘½åå¾Œçš„ç¾¤çµ„ (`cluster_name`) æ‡‰ç”¨æ–¼ DataFrameï¼Œç”¨æ–¼è¦–è¦ºåŒ–ã€‚

### 7. éŸ³æ¨‚æ¨è–¦ç³»çµ±å»ºç«‹
*   æ•´åˆ Autoencoder embeddingã€KMeans èšé¡å’Œ Cosine Similarityï¼Œé–‹ç™¼æ ¸å¿ƒæ¨è–¦å‡½å¼ `recommend_song_ae_cluster`ã€‚
*   å¯¦ä½œã€ŒåŒç¾¤å„ªå…ˆã€è·¨ç¾¤è£œè¶³ã€çš„æ¨è–¦é‚è¼¯ã€‚

## ä½¿ç”¨æ­¥é©Ÿ (Usage Steps)

### 1. é‹è¡Œå‰ç½®ç¨‹å¼ç¢¼
è«‹ç¢ºä¿æ‚¨å·²ä¾ç…§ Colab Notebook ä¸­çš„é †åºåŸ·è¡Œäº†æ‰€æœ‰å‰ç½®çš„ç¨‹å¼ç¢¼å„²å­˜æ ¼ï¼ŒåŒ…æ‹¬æ•¸æ“šè¼‰å…¥ã€é è™•ç†ã€Autoencoder è¨“ç·´ã€KMeans èšé¡ä»¥åŠ embedding æ¬„ä½çš„å»ºç«‹ã€‚

### 2. ä½¿ç”¨ `recommend_song_ae_cluster` å‡½å¼é€²è¡Œæ¨è–¦

æ‚¨å¯ä»¥ä½¿ç”¨ `recommend_song_ae_cluster` å‡½å¼ä¾†ç²å–æ­Œæ›²æ¨è–¦ã€‚è©²å‡½å¼æœƒæ ¹æ“šæ‚¨æä¾›çš„ç›®æ¨™æ­Œæ›²ï¼Œåˆ©ç”¨è¨“ç·´å¥½çš„æ¨¡å‹æ¨è–¦ç›¸ä¼¼æ­Œæ›²ã€‚

**å‡½å¼ç°½å:**
```python
recommend_song_ae_cluster(
    cluster_col,          # str: ç”¨æ–¼æ¨è–¦çš„èšé¡æ¬„ä½åç¨± (e.g., 'cluster_ae_kmeans')
    embedding_cols,       # list: Autoencoder embedding æ¬„ä½åç¨±åˆ—è¡¨ (e.g., ['emb_0', 'emb_1', ...])
    song_name,            # str: ç›®æ¨™æ­Œæ›²åç¨±
    artist=None,          # str, optional: ç›®æ¨™æ­Œæ›²çš„è—è¡“å®¶åç¨± (å¯é¸ï¼Œæä¾›å¯æé«˜æº–ç¢ºæ€§)
    n_recommendations=5,  # int: ç¸½å…±éœ€è¦çš„æ¨è–¦æ•¸é‡ (é è¨­ç‚º 5)
    max_per_cluster=2     # int: è·¨ cluster fallback æ™‚ï¼Œæ¯å€‹ cluster æœ€å¤šå–å¹¾é¦– (é è¨­ç‚º 2)
)
```

**ç¯„ä¾‹:**

```python
# å‡è¨­ embedding_cols å·²ç”±å‰ç½®ç¨‹å¼ç¢¼ç”Ÿæˆä¸¦å„²å­˜åˆ°è®Šæ•¸ä¸­
# ä¾‹å¦‚: embedding_cols = [f"emb_{i}" for i in range(X_emb.shape[1])]

# æ¨è–¦æ­Œæ›² 'Comedy'ï¼Œè—è¡“å®¶ 'Gen Hoshino'
recommendations = recommend_song_ae_cluster(
    cluster_col="cluster_ae_kmeans",
    embedding_cols=embedding_cols,
    song_name="Comedy",
    artist="Gen Hoshino",
    n_recommendations=5,
    max_per_cluster=2
)

# é¡¯ç¤ºæ¨è–¦çµæœ
if recommendations is not None:
    display(recommendations)
```

**è¼¸å‡ºç¯„ä¾‹:**

```
ğŸµ Recommendations for 'Comedy' (Artist: Gen Hoshino):

             track_name        artists  cluster  distance
13373       Butterflies      Fiji Blue        7  0.994472
13798          COLORWAY  DESTIN CONRAD        7  0.994398
4515                é¦¬ã¨é¹¿  Kenshi Yonezu        7  0.993604
13773        Used to Me    Luke Chiang        7  0.993323
13015  Strawberry Skies     Kid Travis        7  0.992104
```

è«‹æ ¹æ“šæ‚¨è¦æ¨è–¦çš„æ­Œæ›²æ›¿æ› `song_name` å’Œ `artist` åƒæ•¸ã€‚
